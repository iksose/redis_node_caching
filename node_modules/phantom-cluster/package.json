{
  "name": "phantom-cluster",
  "version": "0.1.0",
  "author": {
    "name": "Yusuf Simonson",
    "email": "yusuf@themuse.com"
  },
  "description": "Provides a cluster of workers for phantomjs processing",
  "repository": {
    "type": "git",
    "url": "https://github.com/dailymuse/phantom-cluster"
  },
  "keywords": [
    "phantom",
    "phantomjs",
    "cluster"
  ],
  "dependencies": {
    "phantomjs": "~1.9.2-0",
    "phantom": "git://github.com/sgentle/phantomjs-node.git#d4e40cae23c069c35500b8282cf3e41d3afb6d1e"
  },
  "devDependencies": {
    "nodeunit": "0.8.2",
    "coffee-script": "1.6.3"
  },
  "license": "MIT",
  "readme": "# phantom-cluster\n\nPhantom-cluster is a cluster of node.js workers for processing requests with\nphantomjs instances.\n\nBecause you can spawn multiple workers, requests can be processed in parallel.\nAt the same time, the limited number of workers prevents you from spinning up\ntoo many memory-intensive phantomjs instances. Further, there's some added\nlogic to automatically restart workers after a few iterations to prevent\nmemory leaks.\n\nFor a full example, see\n[example.coffee](https://github.com/dailymuse/phantom-cluster/blob/master/example.coffee).\n\n## Communication-agnostic engines\n\nIf you want to use a custom communication mechanism, or do not wish to use a\nFIFO queue, you can use the communication-agnostic engines, represented with\n`PhantomClusterServer` and `PhantomClusterClient`. In this mode, the server\nspins up workers, and workers coordinate access to the phantomjs process, but\nthat's it. It's up to you to figure out how to get the server to send requests\nto clients.\n\nSpin up new instances of these classes via `create()`, i.e.:\n\n    var phantomCluster = require(\"phantom-cluster\");\n    var engine = phantomCluster.create({ ...options... });\n    ...\n\nThe options for `create`:\n\n* `numWorkers`: The number of workers to spin up (defaults to the number of\n  CPUs available.)\n* `iterations`: The number of work iterations to execute before killing this\n  worker and restarting it. This is available to prevent phantomjs memory\n  leaks from exhausting all the system memory (defaults to 100.)\n* `phantomArguments`: An array of strings specifying command-line arguments to\n  pass into the phantomjs process. See\n  [the phantomjs docs](https://github.com/ariya/phantomjs/wiki/API-Reference#command-line-options)\n  for a list of available arguments. Defaults to no arguments.\n* `phantomBinary`: A string specifying the location of the phantomjs binary.\n  By default this is auto-detected.\n* `phantomBasePort`: The base port from which workers should create unique\n  ports to communicate with the phantomjs process.\n\nIf the process is a worker, you'll be returned an instance of\n`PhantomClusterClient`. Otherwise you'll be returned an instance of\n`PhantomClusterServer`.\n\n### PhantomClusterServer\n\n#### Methods\n\n* `addWorker`: Adds a new worker.\n* `start`: Starts the server and spins up the workers.\n* `stop`: Stops the server and kills the workers.\n\n#### Events\n\n* `workerStarted`: A new worker has been added to the pool.\n* `workerDied`: A worker has died.\n* `started`: The engine has started.\n* `stopped`: The engine has stopped.\n\n#### Properties\n\n* `workers`: Mapping of worker IDs to worker objects.\n* `done`: Whether the engine is done (i.e. whether `stop()` has been called.)\n\n### PhantomClusterClient\n\n#### Methods\n\n* `next`: Call this method when you've finished processing a request.\n* `start`: Starts the client.\n* `stop`: Stops the client.\n\n#### Events\n\n* `phantomStarted`: The phantom instance has started up.\n* `phantomDied`: The phantom instance has died.\n* `workerReady`: Attach a listener to this event to handle a request. It will\n  be called when phantomjs is ready.\n* `started`: The engine has started.\n* `stopped`: The engine has stopped.\n\n#### Properties\n\n* `ph`: The phantom instance. See the\n  [phantomjs-node documentation](https://github.com/sgentle/phantomjs-node) on\n  how to use it.\n* `iterations`: The number of iterations left before this worker is killed.\n\n## Queued engines\n\nphantom-cluster exposes a server/client setup that builds on the\ncommunication-agnostic server/client that processes requests via a FIFO queue.\nCommunication between the server and workers is facilitated via node.js'\nbuilt-in IPC mechanism. This should suit most needs and is the default setup.\n\nIn this setup, requests should be\n[idempotent](https://en.wikipedia.org/wiki/Idempotence) - that is, multiple\nexecutions of the request should yield the same result. This is because\nrequests have a built-in timeout. This is to prevent lost requests from, e.g.\nworkers that suddenly die.\n\nSpin up new instances of these classes via `createQueued()`, i.e.:\n\n    var phantomCluster = require(\"phantom-cluster\");\n    var engine = phantomCluster.createQueued({ ...options... });\n    ...\n\nThe options for `createQueued` including all of the options for `create`, and\nadditionally:\n\n* `messageTimeout`: Sets the timeout for requests. After this timeout the\n  request is re-enqueued. Again, you'll be returned either a\n  `PhantomQueuedClusterServer` or `PhantomQueuedClusterClient` depending on\n  whether this is a worker process or not.\n\n### PhantomQueuedClusterServer\n\nThis extends `PhantomClusterServer`, so it includes all of their\nmethods/events/properties.\n\n#### Methods\n\n* `enqueue`: Enqueues a new item. The item will later be passed off to a\n  worker, and can be any JSON-serializable object. This method returns an\n  instance of `QueueItem`.\n\n#### Properties\n\n* `queue`: Contains the queue of unprocessed requests.\n\n### PhantomQueuedClusterClient\n\nThis extends `PhantomClusterClient`, so it includes all of their\nmethods/events/properties.\n\n#### Methods\n\n* `queueItemResponse`: Call this method instead of `next` when you've \n  processing the current request, as it notify the server. Pass the response\n  as an argument, which will in turn be passed to the server.\n\n#### Events\n\n* `queueItemReady`: Listen for this method instead of `workerReady`, as it\n  will be called only when both the phantom process is ready and there's a\n  request from the server that should be processed.\n\n### QueueItem\n\nThis is the object returned by `PhantomQueuedClusterServer`'s `enqueue`\nmethod.\n\n#### Events\n\n* `response`: Fired when there is a response that's been returned from a\n  worker.\n* `timeout`: Fired when the request has timed out.\n\n#### Properties\n\n* `id`: The item's unique ID.\n* `request`: The request object.\n* `response`: The response object - set to null until a response has come in.\n",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/dailymuse/phantom-cluster/issues"
  },
  "homepage": "https://github.com/dailymuse/phantom-cluster",
  "_id": "phantom-cluster@0.1.0",
  "dist": {
    "shasum": "19e49d7d328773ac01d817f0571c97fb3c38642b"
  },
  "_resolved": "git://github.com/dailymuse/phantom-cluster.git#87ebc9f2c5fc81792aa4c98ae1c6cf44c784cc5e",
  "_from": "phantom-cluster@git://github.com/dailymuse/phantom-cluster.git#87ebc9f2c5fc81792aa4c98ae1c6cf44c784cc5e"
}
